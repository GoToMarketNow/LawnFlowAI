You are a senior full-stack engineer building LawnFlow.ai in Replit (Next.js + Postgres + Prisma).
Implement the V1 Onboarding & Implementation Agent as an MVP feature set, delivered in sequential sprints.
This agent must guide setup via QUESTIONS (not configuration screens), select safe defaults, and produce a structured config.

Deliverables:
- A YAML/JSON-driven onboarding flow with branching
- A backend “Onboarding Agent” service that runs the flow, stores answers, derives config, and activates templates
- Minimal UI to run the onboarding chat + show progress + confirm config
- A lightweight internal documentation library (agent-readable) to power explanations and safe defaults

IMPORTANT:
- Keep UX clean and intuitive.
- Ask 8–12 questions max.
- Do not block onboarding; make conservative assumptions and flag for review.
- Reuse existing app patterns (auth, layout, RBAC, styling).

================================================================================
SPRINT PLAN (MVP BUILD) — IMPLEMENT IN ORDER
================================================================================

SPRINT 1: Data Model + Flow Definitions (YAML/JSON) + Seeds
SPRINT 2: Onboarding Chat UI + Session Engine (question/answer loop)
SPRINT 3: Branching Logic + Validation + Assumption Handling
SPRINT 4: Derived Configuration Generator + Templates (safe defaults)
SPRINT 5: Confirmation + Activation + “First Win” trigger
SPRINT 6: Agent-readable Docs Library + Retrieval + Polished UX

================================================================================
SPRINT 1 (1/6): DATA MODEL + FLOW FILES + SEED
================================================================================
GOAL
Create the database tables and the flow definition files (YAML + JSON output).
Seed a demo onboarding flow and 3 demo users.

A) PRISMA MODELS
Create these models:

1) OnboardingFlow
- id (uuid)
- version (string)              // "v1"
- name (string)                 // "LawnFlow V1 Implementation"
- definitionJson (jsonb)        // stored JSON form of YAML after parse
- isActive (bool)
- createdAt, updatedAt

2) OnboardingSession
- id (uuid)
- accountId
- userId
- flowId
- status (enum)                 // NEW, IN_PROGRESS, AWAITING_CONFIRM, COMPLETE
- currentNodeId (string)
- derivedConfigJson (jsonb)
- flagsJson (jsonb)             // assumptions, revisitLater
- startedAt, completedAt
- createdAt, updatedAt

3) OnboardingAnswer
- id (uuid)
- sessionId
- nodeId (string)
- questionText (text)
- answerValueJson (jsonb)       // {selected:[...], text:"...", number:...}
- confidence (enum)             // HIGH, MEDIUM, LOW
- assumptionMade (bool)
- revisitLater (bool)
- createdAt

4) ImplementationConfig (optional table; MVP can store in account settings)
- id (uuid)
- accountId
- configJson (jsonb)
- createdAt, updatedAt

B) FLOW FILES
Create:
- /onboarding/flows/lawnflow_v1.yaml   (source-of-truth)
- /onboarding/flows/lawnflow_v1.json   (generated by a build script)
- /onboarding/flows/schema.json        (validation schema)

Add script:
- npm run onboarding:build
That reads YAML -> validates -> outputs JSON.

C) SEED
Seed:
- Demo flow record in OnboardingFlow (v1)
- Demo account + demo users
- Create a NEW OnboardingSession for first login (Owner/Admin)

DONE WHEN
- Migrations apply
- YAML compiles to JSON
- Seeds run

================================================================================
SPRINT 2 (2/6): ONBOARDING CHAT UI + SESSION ENGINE
================================================================================
GOAL
Minimal onboarding chat experience with progress + persistence.

UI REQUIREMENTS
- New route: /onboarding
- Shows:
  - chat transcript (agent + user)
  - one question at a time
  - selectable answers (chips) + free text where required
  - progress indicator (e.g., “Step 3 of 10”)
- Store each answer in OnboardingAnswer
- Advance to next nodeId

Backend requirements
- Session engine:
  - load active flow definitionJson
  - read current node
  - render question + options
  - accept answer payload
  - persist answer
  - (Sprint 2) advance in linear order only (no branching yet)

DONE WHEN
- I can complete the full question set linearly and see answers stored

================================================================================
SPRINT 3 (3/6): BRANCHING + VALIDATION + ASSUMPTIONS
================================================================================
GOAL
Enable real branching based on answers + conservative assumptions.

Implement:
- Node transitions based on rules (see YAML)
- Input validation (required, zip format, range options)
- If user says “not sure”:
  - choose conservative default
  - mark assumptionMade=true, revisitLater=true
- Hard limit: max 12 questions (skip optional nodes if not needed)

DONE WHEN
- Flow branches correctly across key paths
- Assumptions are logged and surfaced at summary

================================================================================
SPRINT 4 (4/6): DERIVED CONFIG GENERATOR + SAFE DEFAULT TEMPLATES
================================================================================
GOAL
Translate onboarding answers into a structured ImplementationConfig JSON.

Implement a config generator:
- Takes answers
- Applies mapping rules from YAML “configMappings”
- Outputs:
  - enabledAgents[]
  - automationThresholds{}
  - approvalRules{}
  - quoteTemplates{}
  - notificationRules{}
  - crewCommsRules{}
  - coverageRules{}
  - languagePreference

Add safe default templates:
- Small Residential
- Medium Residential
- Large Residential
- Mid-size Commercial

Store derivedConfigJson in session, and persist config in account settings on acceptance.

DONE WHEN
- Config JSON is produced reliably from different branches

================================================================================
SPRINT 5 (5/6): CONFIRMATION + ACTIVATION + FIRST WIN
================================================================================
GOAL
Show “Here’s how I’ll run your business” summary and activate config.

UI
- /onboarding/review
  - summary bullets
  - show assumptions + “revisit later”
  - Accept / Make changes / Skip

Activation
- On Accept:
  - write ImplementationConfig into account config
  - mark session COMPLETE
  - trigger “First Win”:
    - create a demo lead OR run a safe automated action
    - show the user what LawnFlow will do next

DONE WHEN
- Onboarding ends with a clear “you’re live” state

================================================================================
SPRINT 6 (6/6): DOCS LIBRARY + RETRIEVAL + POLISH
================================================================================
GOAL
Add agent-readable docs for explanations and a polished onboarding UX.

Docs library:
- /docs/product/*.md
- /docs/capabilities/*.md
- /docs/config/*.md

Add a simple retrieval layer:
- keyword search or tag-based lookup (MVP)
- agent uses docs snippets to answer “why are you asking this?”

Polish:
- Better microcopy
- Improved empty states
- i18n ready (EN/ES)

DONE WHEN
- Agent explanations reference docs
- UX feels clean and professional

================================================================================
FLOW DEFINITION (YAML SOURCE OF TRUTH)
================================================================================
Create /onboarding/flows/lawnflow_v1.yaml with this exact content:

---
flow:
  id: "lawnflow_v1"
  name: "LawnFlow V1 Implementation"
  version: "v1"
  maxQuestions: 12
  startNodeId: "q1_services"
  personas:
    - OWNER_ADMIN
    - CREW_LEAD
    - CREW_MEMBER

enums:
  journeyStages: [LEAD, QUALIFY, QUOTE, CONFIRM, SCHEDULE, ASSIGN, BOOK, SERVICE, INVOICE, COLLECT, RETAIN]
  language: [EN, ES]
  serviceAreaMode: [ZIP_CODES, RADIUS, NOT_SURE]
  customerMix: [MOSTLY_RESIDENTIAL, MOSTLY_COMMERCIAL, MIXED]
  jobVolume: [UNDER_10, FROM_10_TO_30, FROM_30_TO_75, OVER_75]
  crewStructure: [JUST_ME, ONE_CREW, MULTI_FIXED, CHANGES_DAILY]
  quotingBehavior: [QUOTE_IMMEDIATELY, RANGE_THEN_CONFIRM, ALWAYS_VISIT]
  approvalComfort: [ONLY_LARGE_OR_UNUSUAL, MOST_QUOTES, ALWAYS_ASK]
  commsPreference: [TEXT_ONLY, TEXT_EMAIL, I_HANDLE_IT]
  crewCommsPreference: [SMS, IN_APP, BOTH]
  autonomyPreference: [ACT_AUTOMATICALLY, ASK_FIRST, DEPENDS]

nodes:
  - id: "q0_welcome"
    type: "message"
    text: "Welcome to LawnFlow. I’ll ask a few questions so I can configure the platform for your business. I’ll choose smart defaults and you can change anything later."
    next: "q1_services"

  - id: "q1_services"
    type: "question"
    question: "What services do you offer most often?"
    inputType: "multi_select"
    options:
      - key: "MOWING"
        label: "Lawn mowing / maintenance"
      - key: "SEASONAL"
        label: "Mulch / cleanup / seasonal"
      - key: "INSTALLS"
        label: "Landscaping installs"
      - key: "TREES_SHRUBS"
        label: "Tree / shrub work"
      - key: "OTHER"
        label: "Other"
    followUps:
      - when:
          includes: ["OTHER"]
        ask: "q1b_other_services"
    next: "q2_customer_mix"

  - id: "q1b_other_services"
    type: "question"
    question: "What other services do you offer?"
    inputType: "text"
    required: true
    next: "q2_customer_mix"

  - id: "q2_customer_mix"
    type: "question"
    question: "Are most of your customers residential, commercial, or a mix?"
    inputType: "single_select"
    options:
      - key: "MOSTLY_RESIDENTIAL"
        label: "Mostly residential"
      - key: "MOSTLY_COMMERCIAL"
        label: "Mostly commercial"
      - key: "MIXED"
        label: "A mix"
    next: "q3_service_area_mode"

  - id: "q3_service_area_mode"
    type: "question"
    question: "How do you define where you work?"
    inputType: "single_select"
    options:
      - key: "ZIP_CODES"
        label: "Zip codes"
      - key: "RADIUS"
        label: "Radius from home base"
      - key: "NOT_SURE"
        label: "I’m not sure / varies"
    transitions:
      - when:
          equals: "ZIP_CODES"
        next: "q3a_zip_codes"
      - when:
          equals: "RADIUS"
        next: "q3b_radius"
      - when:
          equals: "NOT_SURE"
        next: "q3c_not_sure"
    defaultNext: "q4_job_volume"

  - id: "q3a_zip_codes"
    type: "question"
    question: "List the zip codes you service (comma-separated)."
    inputType: "text"
    required: true
    validation:
      pattern: "^(\\s*\\d{5}\\s*,)*\\s*\\d{5}\\s*$"
      error: "Please enter 5-digit zip codes separated by commas."
    next: "q4_job_volume"

  - id: "q3b_radius"
    type: "question"
    question: "How far from your home base do you typically travel?"
    inputType: "single_select"
    options:
      - key: "5"
        label: "5 miles"
      - key: "10"
        label: "10 miles"
      - key: "20"
        label: "20 miles"
      - key: "40"
        label: "40 miles"
    next: "q3b_home_base"

  - id: "q3b_home_base"
    type: "question"
    question: "What’s your home base address or zip code?"
    inputType: "text"
    required: true
    next: "q4_job_volume"

  - id: "q3c_not_sure"
    type: "message"
    text: "No problem. I’ll start with a conservative 10-mile radius and you can refine it later."
    flags:
      assumptionMade: true
      revisitLater: true
    next: "q4_job_volume"

  - id: "q4_job_volume"
    type: "question"
    question: "About how many jobs do you complete in a typical week?"
    inputType: "single_select"
    options:
      - key: "UNDER_10"
        label: "Under 10"
      - key: "FROM_10_TO_30"
        label: "10–30"
      - key: "FROM_30_TO_75"
        label: "30–75"
      - key: "OVER_75"
        label: "75+"
    next: "q5_crew_structure"

  - id: "q5_crew_structure"
    type: "question"
    question: "How do your crews usually work?"
    inputType: "single_select"
    options:
      - key: "JUST_ME"
        label: "Just me"
      - key: "ONE_CREW"
        label: "1 crew with a leader"
      - key: "MULTI_FIXED"
        label: "Multiple crews with fixed leaders"
      - key: "CHANGES_DAILY"
        label: "Crews change day to day"
    next: "q6_quoting_behavior"

  - id: "q6_quoting_behavior"
    type: "question"
    question: "When a new customer requests service, how do you usually quote?"
    inputType: "single_select"
    options:
      - key: "QUOTE_IMMEDIATELY"
        label: "Quote immediately based on info"
      - key: "RANGE_THEN_CONFIRM"
        label: "Provide a range, confirm on site"
      - key: "ALWAYS_VISIT"
        label: "Always visit before quoting"
    next: "q7_approval_comfort"

  - id: "q7_approval_comfort"
    type: "question"
    question: "When should LawnFlow ask you before acting?"
    inputType: "single_select"
    options:
      - key: "ONLY_LARGE_OR_UNUSUAL"
        label: "Only for large or unusual jobs"
      - key: "MOST_QUOTES"
        label: "For most quotes"
      - key: "ALWAYS_ASK"
        label: "Always ask me first"
    next: "q8_customer_comms"

  - id: "q8_customer_comms"
    type: "question"
    question: "How should customers hear from LawnFlow?"
    inputType: "single_select"
    options:
      - key: "TEXT_ONLY"
        label: "Text only"
      - key: "TEXT_EMAIL"
        label: "Text + email"
      - key: "I_HANDLE_IT"
        label: "I’ll handle communication myself"
    next: "q9_crew_comms"

  - id: "q9_crew_comms"
    type: "question"
    question: "How should your crews get updates?"
    inputType: "single_select"
    options:
      - key: "SMS"
        label: "Text messages"
      - key: "IN_APP"
        label: "In-app notifications"
      - key: "BOTH"
        label: "Both"
    next: "q10_autonomy"

  - id: "q10_autonomy"
    type: "question"
    question: "If LawnFlow is confident, should it act automatically or pause?"
    inputType: "single_select"
    options:
      - key: "ACT_AUTOMATICALLY"
        label: "Act automatically"
      - key: "ASK_FIRST"
        label: "Ask me first"
      - key: "DEPENDS"
        label: "Depends on the situation"
    next: "review_summary"

  - id: "review_summary"
    type: "review"
    title: "Here’s how I’ll run your business"
    next: "activation"

  - id: "activation"
    type: "activation"
    text: "You’re live. I’ll take it from here."
    next: null

configMappings:
  services:
    fromNode: "q1_services"
    map:
      MOWING:
        enabledAgents: ["RecurringServiceAgent", "LeadIntakeAgent", "SMSSequencerAgent", "QuoteAgent"]
        quoteTemplate: "RESIDENTIAL_MAINTENANCE"
      SEASONAL:
        enabledAgents: ["SeasonalServiceAgent", "QuoteAgent", "ApprovalAgent"]
        quoteTemplate: "SEASONAL_CLEANUP"
      INSTALLS:
        enabledAgents: ["SiteVisitSchedulerAgent", "ApprovalAgent"]
        approvalRules:
          requireApprovalForQuotes: true
      TREES_SHRUBS:
        enabledAgents: ["SkillCheckAgent", "EquipmentCheckAgent", "ApprovalAgent"]
        approvalRules:
          requireApprovalForQuotes: true

  customerMix:
    fromNode: "q2_customer_mix"
    map:
      MOSTLY_RESIDENTIAL:
        automationThresholds:
          autoQuoteConfidence: 0.75
      MOSTLY_COMMERCIAL:
        automationThresholds:
          autoQuoteConfidence: 0.90
        approvalRules:
          requireApprovalForQuotes: true
      MIXED:
        automationThresholds:
          autoQuoteConfidence: 0.85

  serviceArea:
    fromNode: "q3_service_area_mode"
    map:
      ZIP_CODES:
        coverageRules:
          mode: "ZIP_CODES"
          zipCodesFromNode: "q3a_zip_codes"
      RADIUS:
        coverageRules:
          mode: "RADIUS"
          milesFromNode: "q3b_radius"
          homeBaseFromNode: "q3b_home_base"
      NOT_SURE:
        coverageRules:
          mode: "RADIUS"
          miles: 10
          assumed: true

  crewComms:
    fromNode: "q9_crew_comms"
    map:
      SMS:
        notificationRules:
          crewChannels: ["SMS"]
      IN_APP:
        notificationRules:
          crewChannels: ["IN_APP", "PUSH"]
      BOTH:
        notificationRules:
          crewChannels: ["SMS", "IN_APP", "PUSH"]

  autonomy:
    fromNode: "q10_autonomy"
    map:
      ACT_AUTOMATICALLY:
        automationThresholds:
          actMode: "AUTO"
      ASK_FIRST:
        automationThresholds:
          actMode: "HUMAN_APPROVAL"
      DEPENDS:
        automationThresholds:
          actMode: "CONFIDENCE_GATED"
          autoActConfidence: 0.85

================================================================================
JSON OUTPUT REQUIREMENT
================================================================================
Your onboarding build script must output /onboarding/flows/lawnflow_v1.json with the same structure
as the parsed YAML, and it must validate required fields.

================================================================================
IMPLEMENTATION NOTES
================================================================================
- Keep the agent deterministic for onboarding (no LLM required to advance nodes).
- LLM can be used only to generate friendly summaries/explanations, not to control branching.
- Keep a “revisit later” list and show it in the review screen.
- Ensure EN/ES ready by storing question/option text keys; translations can come later.

NOW DO THIS:
Implement Sprint 1 only.
After Sprint 1 runs, print:
- migrations created
- files added
- commands to run
- how to verify the flow JSON generation
Then proceed sprint-by-sprint.